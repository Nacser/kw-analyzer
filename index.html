<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Analizador de Palabras Clave</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>

<!-- ================================================================
     HEADER
     ================================================================ -->
<header class="app-header">
    <div class="header-brand">
        <h1>Analizador de Palabras Clave</h1>
        <button id="btnInfoApp">?</button>
    </div>
    <nav class="header-nav">
        <button id="btnModoUnArchivo" class="nav-btn">Un archivo</button>
        <button id="btnModoMultiplesArchivos" class="nav-btn">Varios archivos</button>
        <button id="btnModoSearchConsole" class="nav-btn">Search Console</button>
    </nav>
</header>

<!-- ================================================================
     POPUP INFO
     ================================================================ -->
<div id="popupInfoApp">
    <div class="info-popup-content">
        <button class="info-close-btn" onclick="cerrarInfoApp()">√ó</button>
        <h2>üéØ Analizador de Palabras Clave</h2>
        <p class="info-intro">Herramienta profesional para analizar, filtrar y exportar datos de palabras clave desde archivos Excel (formato KeywordTool).</p>
        <div class="info-section">
            <h3>üìä Modos de Trabajo</h3>
            <ul>
                <li><strong>Un archivo:</strong> An√°lisis completo de un √∫nico archivo con todos los filtros disponibles</li>
                <li><strong>Varios archivos:</strong> Procesamiento y comparaci√≥n de m√∫ltiples archivos simult√°neamente</li>
                <li><strong>Search Console:</strong> Combina datos de KeywordTool con m√©tricas de Google Search Console</li>
            </ul>
        </div>
        <div class="info-section">
            <h3>üîç Funcionalidades Principales</h3>
            <ul>
                <li><strong>Filtros avanzados:</strong> Por volumen, competencia, CPC, n√∫mero de palabras y m√°s</li>
                <li><strong>Agrupaci√≥n inteligente:</strong> Organiza keywords por t√©rminos en acordeones desplegables</li>
                <li><strong>Selecci√≥n manual:</strong> Checkboxes para exportar solo las keywords que necesitas</li>
                <li><strong>Visualizaci√≥n de datos:</strong> Gr√°ficas de evoluci√≥n mensual por keyword</li>
                <li><strong>B√∫squeda directa:</strong> Acceso r√°pido a Google Search para cada keyword</li>
            </ul>
        </div>
        <div class="info-section">
            <h3>üì• Exportaci√≥n</h3>
            <ul>
                <li>Exporta datos completos o solo keywords seleccionadas</li>
                <li>Exportaci√≥n por grupos cuando uses la agrupaci√≥n</li>
                <li>M√∫ltiples formatos: Excel individual, agrupado o ZIP</li>
            </ul>
        </div>
        <div class="info-section">
            <h3>üí° Consejos de Uso</h3>
            <ul>
                <li>Usa la <strong>agrupaci√≥n</strong> para organizar keywords por categor√≠as (ej: "crema, serum, aceite")</li>
                <li>El bot√≥n <strong>üìà</strong> junto a cada keyword muestra su evoluci√≥n temporal</li>
                <li>Click en la keyword abre b√∫squeda de Google en nueva pesta√±a</li>
                <li>Los checkboxes permiten seleccionar manualmente qu√© exportar</li>
                <li>Combina datos con Search Console para ver m√©tricas reales de rendimiento</li>
            </ul>
        </div>
        <div class="info-footer">
            <button onclick="cerrarInfoApp()" class="btn-primary">Entendido, ¬°empecemos!</button>
        </div>
    </div>
</div>

<!-- ================================================================
     SECCION 1: UN ARCHIVO
     ================================================================ -->
<section id="sectionUnArchivo">
    <div class="desktop-grid">

        <!-- PANEL IZQUIERDO: Filtros plegable -->
        <aside class="panel-filtros">
            <button class="sidebar-toggle" title="Ocultar filtros">‚óÄ</button>

            <input type="file" id="fileInput" />

            <div id="activeFilters">
                <div class="filter-section">
                    <div class="filter-section-title">üìä Volumen</div>
                    <label class="filter-row">
                        <input type="checkbox" id="filtroVolumen"> Filtrar por Search Volume
                    </label>
                    <div id="volumenRange">
                        <p>M√≠n: <input type="number" id="minVolume" value=""></p>
                        <p>M√°x: <input type="number" id="maxVolume" value=""></p>
                    </div>
                    <label class="filter-row">
                        <input type="checkbox" id="filtroNumPalabras"> Filtrar n¬∫ palabras
                        <input type="number" id="numPalabrasInput" value="2" min="1" />
                    </label>
                </div>
                <div class="filter-section">
                    <div class="filter-section-title">üîß Opciones</div>
                    <label class="filter-row">
                        <input type="checkbox" id="filtroDuplicados"> Eliminar duplicados (orden/acento)
                    </label>
                    <div class="picoSelector">
                        <p>B√∫squedas puntales</p>
                        <select id="selectFiltroPico">
                            <option value="todos">Mostrar todos</option>
                            <option value="solo-pico">Mostrar solo filas con pico</option>
                            <option value="sin-pico">Retirar filas con pico</option>
                        </select>
                    </div>
                </div>
                <div class="filter-section">
                    <div class="filter-section-title">üìù Palabras clave</div>
                    <div class="filtrosPalabras">
                        <div>
                            <label class="filter-row"><input type="checkbox" id="filtroExcluir"> Excluir keywords</label>
                            <input class="entryText" type="text" id="excludeWordsInput" placeholder="Palabras a excluir, separadas por coma">
                        </div>
                        <div>
                            <label class="filter-row"><input type="checkbox" id="filtroIncluir"> Incluir keywords</label>
                            <input class="entryText" type="text" id="incluirWordsInput" placeholder="Palabras a incluir, separadas por coma">
                        </div>
                        <div>
                            <label class="filter-row"><input type="checkbox" id="filtroAgrupar"> Agrupar por t√©rminos</label>
                            <input class="entryText" type="text" id="agruparInput" placeholder="T√©rminos separados por coma (ej: crema, hidratante)">
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- PANEL DERECHO -->
        <main class="panel-principal">

            <!-- Resumen plegable -->
            <div class="summary-wrapper">
                <div class="summary-header" onclick="this.closest('.summary-wrapper').classList.toggle('collapsed')">
                    <span class="toggle-icon">‚ñº</span>
                    <span class="summary-title">üìä Resumen</span>
                </div>
                <div class="summary-body">
                    <div id="summary"></div>
                </div>
            </div>

            <!-- Toolbar -->
            <div class="table-buttons" id="pre-table">
                <div class="month-order">
                    <label>Ordenar por mes: <select id="selectMes"></select></label>
                </div>
                <div class="toolbar-actions">
                    <button class="btnExportExcel" id="btnExportExcel">üì• Exportar datos filtrados</button>
                    <button class="btn-copiar" id="btnCopiarKeywords" data-tooltip="Copia en portapapeles las keywords para pegar en herramienta de SERPs u otros usos.">üìã Copiar keywords</button>
                </div>
            </div>

            <!-- Barra scroll + Tabla -->
            <div class="scroll-nav" id="scrollNav1" title="Barra de navegaci√≥n horizontal: haz clic para saltar a cualquier posici√≥n de la tabla"><div class="scroll-nav-thumb"></div></div>
            <div id="table"></div>
        </main>
    </div>
</section>

<!-- ================================================================
     SECCION 2: MULTIPLES ARCHIVOS
     ================================================================ -->
<div id="sectionMultiplesArchivos" style="display:none;">
    <div class="desktop-grid">

        <!-- PANEL IZQUIERDO -->
        <aside class="panel-filtros">
            <button class="sidebar-toggle" title="Ocultar filtros">‚óÄ</button>

            <input type="file" id="mm_multiFileInput" multiple />

            <div class="card">
                <h3 class="card-title">üìÅ Archivos Cargados</h3>
                <div class="card-content"><span id="mm_nombreArchivos">Ninguno</span></div>
            </div>

            <div class="card">
                <h3 class="card-title">üîç Filtros</h3>
                <div class="filtros-grid-mm">
                    <div class="filter-box">
                        <label class="filter-label"><input type="checkbox" id="mm_filtroVolumen" class="filter-checkbox" /> Filtrar por volumen</label>
                        <div class="volumen-inputs">
                            <input type="number" id="mm_minVolume" placeholder="M√≠n" class="filter-input"/>
                            <input type="number" id="mm_maxVolume" placeholder="M√°x" class="filter-input"/>
                        </div>
                    </div>
                    <div class="filter-box">
                        <label class="filter-label"><input type="checkbox" id="mm_filtroDuplicados" class="filter-checkbox" /> Quitar duplicados</label>
                    </div>
                    <div class="filter-box filter-box-full">
                        <label class="filter-label"><input type="checkbox" id="mm_filtroExcluir" class="filter-checkbox" /> Excluir keywords</label>
                        <input type="text" id="mm_excludeWordsInput" placeholder="palabra1, palabra2, ..." class="filter-text-input"/>
                    </div>
                    <div class="filter-box filter-box-full">
                        <label class="filter-label"><input type="checkbox" id="mm_filtroIncluir" class="filter-checkbox" /> Incluir solo keywords</label>
                        <input type="text" id="mm_incluirWordsInput" placeholder="palabra1, palabra2, ..." class="filter-text-input"/>
                    </div>
                    <div class="filter-box filter-box-full">
                        <label class="filter-label"><input type="checkbox" id="mm_filtroAgrupar" class="filter-checkbox" /> Agrupar por t√©rminos</label>
                        <input type="text" id="mm_agruparInput" placeholder="T√©rminos separados por coma..." class="filter-text-input"/>
                    </div>
                    <div class="filter-box">
                        <label class="filter-label"><input type="checkbox" id="mm_soloPrimerDato" class="filter-checkbox" /> Solo primera fila por archivo</label>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">‚ö° Acciones</h3>
                <div class="action-buttons">
                    <button id="mm_btnProcesar" class="btn-primary" data-tooltip="Aplica los filtros seleccionados">üîÑ Procesar y Mostrar</button>
                    <button id="mm_btnExportarMultiples" class="btn-primary" data-tooltip="Exporta en un √∫nico Excel agrupado por primera palabra">üì• Exportar a Excel</button>
                    <button id="mm_btnCopiarKeywords" class="btn-copiar" data-tooltip="Copia en portapapeles las keywords para pegar en herramienta de SERPs u otros usos.">üìã Copiar keywords</button>
                    <button id="mm_btnExportarZip" class="btn-warning" data-tooltip="ZIP con Excel por archivo">üóúÔ∏è Exportar en ZIP</button>
                    <button id="mmbtnUnirArchivos" class="btn-purple" data-tooltip="Une archivos por palabra clave">üîó Unir por Palabra Clave</button>
                </div>
            </div>
        </aside>

        <!-- PANEL DERECHO -->
        <main class="panel-principal">

            <!-- Resumen plegable -->
            <div class="summary-wrapper">
                <div class="summary-header" onclick="this.closest('.summary-wrapper').classList.toggle('collapsed')">
                    <span class="toggle-icon">‚ñº</span>
                    <span class="summary-title">üìä Resumen</span>
                </div>
                <div class="summary-body">
                    <div id="mm_resumenMultiples">Esperando archivos...</div>
                </div>
            </div>

            <!-- Barra scroll + Tabla -->
            <div class="scroll-nav" id="scrollNav2" title="Barra de navegaci√≥n horizontal: haz clic para saltar a cualquier posici√≥n de la tabla"><div class="scroll-nav-thumb"></div></div>
            <div id="mm_tablaMultiples"></div>
        </main>
    </div>
</div>

<!-- ================================================================
     SECCION 3: SEARCH CONSOLE
     ================================================================ -->
<div id="sectionSearchConsole" style="display:none;">
    <div class="sc-layout">
        <div class="sc-steps-row">
            <div class="card sc-step">
                <div class="step-number">1</div>
                <h3 class="card-title">Carga tus archivos</h3>
                <p class="sc-description">Sube un archivo de keywords (KeywordTool) y un export de Search Console (Excel)</p>
                <div class="sc-files-grid">
                    <div>
                        <label class="sc-file-label">Keywords File (Excel)</label>
                        <input type="file" id="scKeywordsFile" accept=".xlsx" />
                    </div>
                    <div>
                        <label class="sc-file-label">Search Console File (Excel)</label>
                        <input type="file" id="scConsoleFile" accept=".xlsx" />
                    </div>
                </div>
            </div>
            <div class="card sc-step">
                <div class="step-number">2</div>
                <h3 class="card-title">Configurar combinaci√≥n</h3>
                <p class="sc-description">Selecciona qu√© columna usar para unir ambos archivos</p>
                <div class="sc-config">
                    <div class="sc-config-row">
                        <label class="sc-file-label">Columna de uni√≥n:</label>
                        <select id="scJoinColumn">
                            <option value="keyword">Keyword / Query</option>
                            <option value="url">URL / Landing Page</option>
                        </select>
                    </div>
                    <label class="sc-config-check">
                        <input type="checkbox" id="scOnlyMatches" checked />
                        Solo mostrar keywords con datos de Search Console
                    </label>
                </div>
                <button id="btnCombinarSC" class="btn-primary btn-combinar">üîó Combinar Archivos</button>
            </div>
        </div>
        <div id="scResults" class="card" style="display: none;">
            <div class="sc-results-header">
                <h3 class="card-title">Resultados Combinados</h3>
                <div class="toolbar-actions">
                    <button id="btnExportSC" class="btn-primary">üì• Exportar Excel</button>
                    <button id="sc_btnCopiarKeywords" class="btn-copiar" data-tooltip="Copia en portapapeles las keywords para pegar en herramienta de SERPs u otros usos.">üìã Copiar keywords</button>
                </div>
            </div>
            <div class="scroll-nav" id="scrollNav3" title="Barra de navegaci√≥n horizontal: haz clic para saltar a cualquier posici√≥n de la tabla"><div class="scroll-nav-thumb"></div></div>
            <div id="scTable"></div>
        </div>
    </div>
</div>

<!-- POPUP GRAFICA -->
<div id="popupGrafica">
    <div id="graficaContainer">
        <button id="btnCerrarGrafica" class="close-btn" title="Cerrar">√ó</button>
    </div>
</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="script.js"></script>
<script src="addon-navegacion.js"></script>
<script src="script-multiple.js"></script>
<script src="ui-controls.js"></script>
</body>
</html>
